{% extends 'base.html.twig' %}

{% block title %}Commande{% endblock %}

{% block body %}

    {# Barre de navigation #}
    {% include "account/navbar.html.twig" %}

    <h2 class="text-center color-primary-custom my-4">Passer une commande</h2>

    {# Conteneur principal de la commande #}
    <div class="container my-5">

        <div class="row">

            <div class="col-md-8">

                {% if order is empty %}
                    <p class="text-center color-primary-custom" role="alert">Vous n'avez pas de commande en cours.</p>
                {% else %}
                    <section role="region" aria-labelledby="title-order">
                        <h2 id="title-order" class="text-center color-primary-custom my-4">Détails de la commande</h2>
                        {% for item in order %}
                            <article class="card mb-4 shadow-sm border-1" role="group" aria-labelledby="order-{{ item.activityName ?? item.eventName ?? item.offerName }}">
                                <div class="row g-0">
                                    <div class="col-md-4">
                                        <picture>
                                            <source srcset="/uploads/photos/{{ item.activityImage ?? item.eventImage ?? item.offerImage | replace({'.jpg': '.webp', '.png': '.webp'}) }}" type="image/webp">
                                            <img 
                                                src="/uploads/photos/{{ item.activityImage ?? item.eventImage ?? item.offerImage }}" 
                                                class="img-fluid rounded-start h-100 object-fit-cover" 
                                                alt="{{ item.activityName ?? item.eventName ?? item.offerName }} - Commande"
                                                loading="lazy"
                                                width="200" height="150"
                                            >
                                        </picture>
                                    </div>
                                    <div class="col-md-8">
                                        <div class="card-body">
                                            <h3 id="order-{{ item.activityName ?? item.eventName ?? item.offerName }}" class="card-title fw-bold">{{ item.activityName ?? item.eventName ?? item.offerName }}</h3>
                                            <div class="d-flex">
                                                <div class="col-sm-6 col-md-6 pe-2">
                                                    <p class="card-text">
                                                        <strong>Partenaire :</strong> {{ item.partners.name }}
                                                    </p>
                                                    <p class="card-text">
                                                        <strong>Adresse :</strong>
                                                        <a href="{{ item.partners.getGoogleMapsLink() }}" target="_blank" class="text-decoration-none color-primary-custom">
                                                            {{ item.partners.address }}
                                                        </a>
                                                    </p>
                                                </div>
                                                <div class="col-sm-6 col-md-6">
                                                    <p class="card-text"><span><strong>Prix unitaire :</strong></span>
                                                        <strong>{{ item.price|price }}</strong>
                                                    </p>
                                                    <p class="card-text">
                                                        <i class="bi bi-person-fill me-2"></i>
                                                        Pour <strong>x{{ item.peopleCount }}</strong> personne(s)
                                                    </p>
                                                    <p class="card-text d-flex align-items-center gap-3">
                                                        <span class="fw-semibold">Quantité :</span>
                                                        <a href="{{ path('app_order_decrease', { id: item.id } ) }}" class="btn shadow-sm rounded-circle p-0">
                                                            <i class="bi bi-dash-lg color-primary-custom"></i>
                                                        </a>
                                                        <span id="quantity-{{ item.id }}" class="badge bg-primaryBlue">{{ item.qty }}</span>
                                                        <a href="{{ path('app_order_add', { id: item.id } ) }}" class="btn shadow-sm rounded-circle p-0">
                                                            <i class="bi bi-plus-lg color-primary-custom"></i>
                                                        </a>
                                                    </p>
                                                    <p class="card-text"><strong>Total :</strong>
                                                        <span class="text-success">{{ (item.qty * item.price)|price }}</span>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </article>
                        {% endfor %}
                    </section>

                    {# Formulaire de commande #}
                    <div class="card shadow-sm border-1 p-4">
                        <h3 class="text-center color-primary-custom">Finaliser votre commande</h3>
                        {{ form_start(orderForm) }}
                            {{ form_row(orderForm.dateStart) }}
                            {{ form_row(orderForm.time) }}
                            {{ form_row(orderForm.submit, { 'attr': {'class': 'btn btn-primary d-block mx-auto w-40'} }) }}
                        {{ form_end(orderForm) }}
                    </div>

                {% endif %}
            </div>

            {# Colonne de droite pour les informations récapitulatives ou autres détails #}
            <div class="col-md-4">
                <div class="card p-3 shadow-sm">
                    <h3 class="color-primary-custom">Résumé de votre commande</h3>
                    <ul class="list-group list-group-flush">
                        {% for item in order %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                {{ item.activityName ?? item.eventName ?? item.offerName }}
                                <span class="badge bg-primaryBlue">{{ item.qty }}</span>
                            </li>
                        {% endfor %}
                    </ul>
                    <div class="mt-3 text-center">
                        <strong>Total :</strong>
                        <span class="text-success fs-5">{{ order.cartPrice|price }}</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center mt-4">
            <a href="{{ path('app_cart') }}" class="btn btn-primary">Retour au panier</a>
        </div>

    </div>

{% endblock %}
