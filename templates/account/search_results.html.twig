{% extends 'base.html.twig' %}

{% block title %}{{ controller_name }}{% endblock %}

{% block body %}
    {# ğŸ”¹ Barre de navigation #}
    {% include "account/navbar.html.twig" %}

    <div class="d-flex flex-column flex-sm-row justify-content-center align-items-center gap-3">
        
        {# ğŸ”¹ Section : Vos Avis #}
        <div class="col-md-8 toast d-flex m-3 p-3 flex-column">
			<div class="row d-flex justify-content-between align-items-center">
				<h1 class="mb-4 col-md-6">{{ controller_name }}</h1>

				{# ğŸ”¹ Bouton pour afficher tous les avis avec filtre #}
				<button class="col-auto btn btn-primary m-3" data-bs-toggle="collapse" data-bs-target="#collapseAvis" aria-expanded="false" aria-controls="collapseAvis">
					Filtrer les avis
				</button>
			</div>

			{# ğŸ”¹ Collapse : Liste complÃ¨te des avis avec filtres et pagination #}
			<div class="collapse mt-3" id="collapseAvis" aria-labelledby="filterReviewsButton" aria-hidden="true">
				<div class="card card-body bg-background border-0">

					{# ğŸ”¹ En-tÃªte avec titre et bouton de fermeture #}
					<div class="d-flex justify-content-between align-items-center mb-3">
						<h2 class="me-auto color-primary-custom" id="filterReviewsButton">Rechercher des avis</h2>
						<button class="btn-close" data-bs-toggle="collapse" data-bs-target="#collapseAvis" aria-label="Fermer" aria-expanded="false" aria-controls="collapseAvis"></button>
					</div>

					{# ğŸ”¹ Formulaire de recherche des avis #}
					<section class="p-2 overflow-auto" style="max-height: 75vh;">
						{{ form_start(searchRatingForm, {'method': 'GET', 'attr': {'class': 'mb-3 search-rating-form', 'id': 'searchRatingForm', 'action': path('app_search_rating') } }) }}

							{# ğŸ”¹ Recherche et boutons d'action #}
							<div class="bg-primaryBlue border-secondary-custom p-2 mb-3">
								<div class="row">
									<div class="col-md-8">{{ form_row(searchRatingForm.search, {'attr': {'aria-label': 'Recherche d\'avis'}}) }}</div>
									<div class="col-md-4">
										{{ form_row(searchRatingForm.submit, {'attr': {'aria-label': 'Soumettre la recherche'}}) }}
										{{ form_row(searchRatingForm.reset, {'attr': {'aria-label': 'RÃ©initialiser la recherche'}}) }}
									</div>
								</div>
							</div>
							
							{# ğŸ”¹ Filtres par score et date #}
							<div class="bg-primaryBlue border-secondary-custom p-2 mb-3">
								<div class="row">
									<div class="col-md-8">{{ form_row(searchRatingForm.score, {'attr': {'aria-label': 'Filtrer par score'}}) }}</div>
									<div class="col-md-4 text-center">{{ form_row(searchRatingForm.createdAt, {'attr': {'aria-label': 'Filtrer par date'}}) }}</div>
								</div>
							</div>

							{# ğŸ”¹ Filtres par activitÃ©, Ã©vÃ©nement et offre #}
							<div class="bg-primaryBlue border-secondary-custom p-2 mb-3">
								<div class="row">
									<div class="col-md-4">{{ form_row(searchRatingForm.activity, {'attr': {'aria-label': 'Filtrer par activitÃ©'}}) }}</div>
									<div class="col-md-4">{{ form_row(searchRatingForm.event, {'attr': {'aria-label': 'Filtrer par Ã©vÃ©nement'}}) }}</div>
									<div class="col-md-4">{{ form_row(searchRatingForm.offer, {'attr': {'aria-label': 'Filtrer par offre'}}) }}</div>
								</div>
							</div>

							{# ğŸ”¹ Filtres par partenaire et utilisateur #}
							<div class="bg-primaryBlue border-secondary-custom p-2 mb-3">
								<div class="row">
									<div class="col-md-6">{{ form_row(searchRatingForm.partner, {'attr': {'aria-label': 'Filtrer par partenaire'}}) }}</div>
									<div class="col-md-6">{{ form_row(searchRatingForm.user, {'attr': {'aria-label': 'Filtrer par utilisateur'}}) }}</div>
								</div>
							</div>
						{{ form_end(searchRatingForm) }}
					</section>
				</div>
			</div>
            
            {% if ratingsData is empty %}
				<p>Aucun avis trouvÃ©.</p>
			{% else %}
				<div class="list-group">
					{% for data in ratingsData %}
						<div class="list-group-item">
							<div class="row">
								<h3 class="mb-1 col-md-6">
									<strong>Note : </strong>({{ data.rating.score }}/5)

									{# ğŸ”¹ Affichage des Ã©toiles avec accessibilitÃ© et de la note #}
									<span class="visually-hidden">Note : {{ data.rating.score }} sur 5</span>
									
									{% for i in 1..data.fullStars %}
										<i class="bi bi-star-fill" aria-hidden="true"></i>
									{% endfor %}
						
									{% if data.hasHalfStar %}
										<i class="bi bi-star-half" aria-hidden="true"></i>
									{% endif %}
						
									{% if data.emptyStars > 0 %}
										{% for i in 1..data.emptyStars %}
											<i class="bi bi-star" aria-hidden="true"></i>
										{% endfor %}
									{% endif %}
								</h3>

								{# ğŸ”¹ Affichage de la date du commentaire #}
								<small class="color-secondary-custom col-md-6">AjoutÃ© le {{ data.rating.createdAt|date('d/m/Y H:i') }}</small>
							</div>
							
							{# ğŸ”¹ Affichage du loisir concernÃ© #}
							<p class="mb-1 col-md-6"><strong>{{ data.loisir }}</strong></p>

							<div class="row">
								{# ğŸ”¹ Affichage du commentaire #}
								<p class="mb-1 col-md-6">{{ data.rating.comment }}</p>

								{# ğŸ”¹ Affichage du partenaire si non nul #}
								{% if data.partner is not empty %}
									<p>{{ data.partner.name }}</p>
								{% endif %}
							</div>
							<hr class="row border-secondary-custom-top w-50 mx-auto">
						</div>
					{% endfor %}
				</div>

				{# ğŸ”¹ Pagination #}
				<div class="pagination d-flex justify-content-center mt-3">
					{% if currentPage > 1 %}
						<a href="{{ path('app_search_rating', ({'page': currentPage - 1})) }}" class="page-link" aria-label="Page prÃ©cÃ©dente">
							â† PrÃ©cÃ©dent
						</a>
					{% endif %}

					<span class="page-link disabled rounded">Page {{ currentPage }} sur {{ totalPages }}</span>

					{% if currentPage < totalPages %}
						<a href="{{ path('app_search_rating', ({'page': currentPage + 1})) }}" class="page-link" aria-label="Page suivante">
							Suivant â†’
						</a>
					{% endif %}
				</div>
			{% endif %}
        </div>
    </div>
{% endblock %}
{% block javascripts %}
	<script>
		document.querySelector('button[type="reset"]').addEventListener('click', function(event) {
			event.preventDefault();
			// RÃ©initialiser le formulaire
			document.querySelector('.search-rating-form').reset();
			
			// Rediriger vers la page sans paramÃ¨tres de filtre
			window.location.href = '{{ path('app_search_rating') }}';
		});
	</script>
{% endblock %}
